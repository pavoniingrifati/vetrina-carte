<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vetrina di Carte ‚Äì FANTABALLONE</title>
  <meta name="description" content="Vetrina di carte collezionabili con filtri, valutazioni e commenti." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* --- Stili invariati (ho lasciato il tuo design originale) --- */
    :root{
      --bg: #0b0f19;
      --panel: #0f1526; 
      --card: #121a2e;
      --card-2: #0d1325;
      --text: #ecf0ff;
      --muted: #a7b0d3;
      --accent: #6ee7ff;
      --accent-2: #9bff9b;
      --danger: #ff6b6b;
      --ring: rgba(110,231,255,.4);
      --shadow: 0 10px 24px rgba(0,0,0,.45);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background: radial-gradient(1200px 800px at 10% -10%, #132040, transparent), var(--bg);
      color:var(--text); font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    /* ... (mantieni tutti i tuoi stili originali qui) ... */
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="title">
        <div>
          <h1>Vetrina di Carte di Fantaballa</h1>
          <div class="subtitle">Demo con filtri, valutazioni e commenti (dati locali)</div>
        </div>
      </div>
      <div class="toolbar">
        <div class="search">üîé <input id="q" type="search" placeholder="Cerca..."/></div>
        <select id="fGame"><option value="">Tutte le squadre</option></select>
        <select id="fRarity"><option value="">Tutte le rarit√†</option></select>
        <select id="fYear"><option value="">Tutti gli anni</option></select>
        <div class="range">‚≠ê Min: <input id="fRating" type="range" min="0" max="5" value="0" step="1" /><span id="fRatingVal">0</span></div>
        <select id="fSort">
          <option value="name">Ordina: Nome</option>
          <option value="rating">Ordina: Valutazione</option>
          <option value="year">Ordina: Anno</option>
        </select>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div id="grid" class="grid" aria-live="polite"></div>
  </main>

  <footer>
    <div class="foot"><span class="pill">‚ö†Ô∏è Le immagini sono caricate da GitHub Pages</span></div>
  </footer>

  <!-- Modal -->
  <dialog id="dlg"> ... (mantieni il codice modale originale) ... </dialog>

  <!-- Template card -->
  <template id="tplCard">
    <article class="card">
      <div class="badge"></div>
      <img class="thumb" alt="Immagine carta" />
      <div class="content">
        <div class="name"></div>
        <div class="meta"></div>
        <div class="stars"></div>
        <div class="tags"></div>
        <button class="primary open">Apri</button>
      </div>
    </article>
  </template>

  <script>
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const esc = (s='') => s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));

    const STAR_OUT = 'M12 .587l3.668 7.431 8.2 1.192-5.934 5.787 1.401 8.169L12 18.896l-7.335 3.87 1.401-8.169L.132 9.21l8.2-1.192z';
    function starSVG(filled){
      return `<svg class="s" viewBox="0 0 24 24"><path d="${STAR_OUT}" fill="${filled? 'currentColor':'none'}" stroke="currentColor" stroke-width="1.5"/></svg>`;
    }
    function avg(arr){return arr.length? (arr.reduce((a,b)=>a+b,0)/arr.length):0}
    function keyFor(id, type){return `cardhub_${type}_${id}`}
    function loadRatings(id){const raw=localStorage.getItem(keyFor(id,'ratings')); return raw? JSON.parse(raw):[];}
    function saveRating(id,val){const list=loadRatings(id); list.push(val); localStorage.setItem(keyFor(id,'ratings'),JSON.stringify(list));}
    function loadComments(id){const raw=localStorage.getItem(keyFor(id,'comments')); return raw? JSON.parse(raw):[];}
    function addComment(id,c){const list=loadComments(id); list.push(c); localStorage.setItem(keyFor(id,'comments'),JSON.stringify(list));}
    function clearComments(id){localStorage.removeItem(keyFor(id,'comments'));}

    // ====== Data loader da cards.json ======
    let CARDS = [];
    async function loadCards() {
      try {
        const res = await fetch('cards.json', { cache: 'no-store' });
        if (!res.ok) throw new Error('cards.json non trovato');
        CARDS = await res.json();
      } catch (e) {
        console.error('[ERRORE CARICAMENTO CARTE]', e);
        CARDS = [];
      } finally {
        applyFilters();
      }
    }

    function renderStars(container, value, onRate){
      container.innerHTML='';
      const full=Math.round(value);
      for(let i=1;i<=5;i++){
        const btn=document.createElement(onRate?'button':'div');
        btn.innerHTML=starSVG(i<=full);
        if(onRate) btn.addEventListener('click',()=>onRate(i));
        container.appendChild(btn);
      }
      const label=document.createElement('span');
      label.textContent=value?` ${value.toFixed(1)}/5`:' Nessuna valutazione';
      container.appendChild(label);
    }

    function applyFilters(){
      const q=$('#q').value.trim().toLowerCase();
      const game=$('#fGame').value;
      const rarity=$('#fRarity').value;
      const year=$('#fYear').value;
      const minR=+$('#fRating').value;
      const sort=$('#fSort').value;

      let items=CARDS.map(c=>({...c,rating:avg(loadRatings(c.id))}));
      if(q) items=items.filter(c=>(c.name+" "+c.series+" "+c.text).toLowerCase().includes(q));
      if(game) items=items.filter(c=>c.game===game);
      if(rarity) items=items.filter(c=>c.rarity===rarity);
      if(year) items=items.filter(c=>String(c.year)===year);
      if(minR>0) items=items.filter(c=>Math.round(c.rating)>=minR);

      items.sort((a,b)=>{
        if(sort==='rating') return (b.rating||0)-(a.rating||0);
        if(sort==='year') return b.year-a.year;
        return a.name.localeCompare(b.name);
      });

      renderGrid(items);
    }

    function renderGrid(items){
      const grid=$('#grid');
      grid.innerHTML='';
      if(!items.length){ grid.innerHTML='<p style="color:var(--muted)">Nessuna carta trovata.</p>'; return }
      const tpl=$('#tplCard');
      for(const c of items){
        const node=tpl.content.firstElementChild.cloneNode(true);
        node.querySelector('.badge').textContent=c.rarity;
        const img=node.querySelector('.thumb');
        img.src=c.img; img.alt=`Carta ${c.name}`;
        node.querySelector('.name').textContent=c.name;
        node.querySelector('.meta').textContent=`${c.game} ‚Ä¢ ${c.series} ‚Ä¢ ${c.year}`;
        renderStars(node.querySelector('.stars'), c.rating||0, null);
        const tags=node.querySelector('.tags');
        c.tags.forEach(t=>{const s=document.createElement('span'); s.className='tag'; s.textContent=t; tags.appendChild(s);});
        node.querySelector('.open').addEventListener('click',()=>openModal(c));
        grid.appendChild(node);
      }
    }

    function openModal(card){
      // qui mantieni il tuo codice originale del modale
    }

    // ====== Events ======
    ['q','fGame','fRarity','fYear','fSort'].forEach(id=>$('#'+id).addEventListener('input',applyFilters));
    $('#fRating').addEventListener('input',()=>{$('#fRatingVal').textContent=$('#fRating').value; applyFilters();});

    // ====== Init ======
    loadCards();
  </script>
</body>
</html>
