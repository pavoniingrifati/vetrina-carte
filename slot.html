<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Slot Classica – Offline</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@700;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#050814; --border: rgba(255,255,255,.16); --text:#eef3ff; --gold:#ffd36a;
      --shadow: 0 24px 90px rgba(0,0,0,.65); --r:34px;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(1200px 800px at 20% -10%, rgba(255,211,106,.18), transparent 62%),
        radial-gradient(1200px 800px at 120% 10%, rgba(255,77,109,.10), transparent 62%),
        radial-gradient(1200px 800px at 50% 110%, rgba(77,255,184,.10), transparent 62%),
        var(--bg);
      color:var(--text); display:grid; place-items:center; padding:18px;
    }
    .machine{
      width:min(1600px, 98vw); border-radius:var(--r);
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      border:1px solid var(--border); box-shadow:var(--shadow);
      overflow:hidden; position:relative; padding:26px;
    }
    .machine::before{content:"";position:absolute;inset:-60%;
      background:conic-gradient(from 120deg, rgba(255,255,255,0), rgba(255,255,255,.18), rgba(255,255,255,0));
      animation:shine 11s linear infinite; opacity:.20; pointer-events:none;
    }
    @keyframes shine{to{transform:rotate(360deg)}}
    .header{position:relative;display:flex;justify-content:space-between;align-items:center;gap:14px;padding-bottom:18px;z-index:1;}
    .title{font-size:clamp(24px, 3vw, 44px);font-weight:900;letter-spacing:.10em;text-transform:uppercase;text-shadow:0 14px 55px rgba(0,0,0,.45);}
    .win{background:linear-gradient(180deg,#03050b,#0b1022);border:1px solid rgba(255,255,255,.14);
      border-radius:20px;padding:12px 16px;min-width:260px;box-shadow:inset 0 0 0 1px rgba(0,0,0,.55);text-align:center;}
    .win .lbl{font-size:12px;letter-spacing:.22em;opacity:.75}
    .win .val{margin-top:6px;font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:34px;font-weight:900;letter-spacing:.14em;color:var(--gold);text-shadow:0 0 18px rgba(255,211,106,.25);user-select:none;}
    .cabinet{position:relative;z-index:1;display:grid;grid-template-columns:1fr 120px;gap:18px;align-items:stretch;}
    @media(max-width:980px){.cabinet{grid-template-columns:1fr;} .lever{min-height:140px}}
    .reelBox{background:linear-gradient(180deg, rgba(0,0,0,.30), rgba(0,0,0,.16));
      border:1px solid rgba(255,255,255,.16);border-radius:30px;padding:20px;position:relative;overflow:hidden;}
    .marquee{height:44px;border-radius:22px;display:flex;align-items:center;justify-content:center;
      background:linear-gradient(90deg, rgba(255,77,109,.20), rgba(255,211,106,.22), rgba(77,255,184,.16));
      border:1px solid rgba(255,255,255,.12);font-weight:900;letter-spacing:.18em;text-transform:uppercase;font-size:13px;margin-bottom:16px;}
    .reels{display:grid;grid-template-columns:repeat(3, 1fr);gap:18px;align-items:stretch;}
    .window{border-radius:26px;border:3px solid rgba(255,255,255,.16);background:rgba(0,0,0,.32);
      overflow:hidden;aspect-ratio:690/987;position:relative;box-shadow:inset 0 0 0 3px rgba(0,0,0,.35);}
    .img{width:100%;height:100%;object-fit:cover;display:block;background:#070b18;transform:translateZ(0);}
    .payline{position:absolute;left:7%;right:7%;top:50%;height:5px;transform:translateY(-50%);
      background:linear-gradient(90deg, transparent, rgba(255,211,106,.98), transparent);
      filter:drop-shadow(0 0 14px rgba(255,211,106,.6));opacity:.98;pointer-events:none;}
    .frame{position:absolute;inset:0;border-radius:26px;box-shadow:inset 0 0 0 2px rgba(255,255,255,.08), inset 0 -90px 120px rgba(0,0,0,.42);pointer-events:none;}
    .flash{position:absolute;inset:0;display:grid;place-items:center;background:radial-gradient(circle at 50% 50%, rgba(255,211,106,.18), rgba(0,0,0,0) 55%);
      opacity:0;pointer-events:none;transition:opacity .22s ease;z-index:3;}
    .flash.show{opacity:1}
    .flash .banner{padding:14px 18px;border-radius:999px;background:linear-gradient(135deg, rgba(255,211,106,.30), rgba(255,77,109,.18));
      border:1px solid rgba(255,255,255,.22);box-shadow:0 18px 55px rgba(0,0,0,.55);
      font-weight:900;letter-spacing:.18em;text-transform:uppercase;}
    .lever{border-radius:30px;background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.14);display:flex;align-items:center;justify-content:center;padding:18px 12px;position:relative;overflow:hidden;min-height:520px;}
    .rail{width:16px;height:100%;border-radius:999px;background:linear-gradient(180deg, #cfd6ea, #6b7692);
      box-shadow:inset 0 0 0 1px rgba(0,0,0,.35), 0 18px 48px rgba(0,0,0,.35);position:relative;}
    .knob{width:56px;height:56px;border-radius:999px;background:radial-gradient(circle at 30% 30%, #fff, #ff7a92 40%, #c71f43 72%);
      box-shadow:0 18px 38px rgba(0,0,0,.45), inset 0 0 0 2px rgba(255,255,255,.18);
      position:absolute;left:50%;transform:translateX(-50%);top:18px;transition:top .18s ease;}
    .lever.pull .knob{top:calc(100% - 74px);}
    .spinBtn{position:absolute;bottom:14px;left:14px;right:14px;border:0;cursor:pointer;padding:16px 10px;border-radius:20px;
      font-weight:900;letter-spacing:.18em;text-transform:uppercase;color:#08101c;
      background:linear-gradient(135deg, var(--gold), rgba(255,211,106,.65));box-shadow:0 18px 55px rgba(0,0,0,.45);
      transition:transform .12s ease, filter .12s ease, opacity .12s ease;}
    .spinBtn:hover{filter:brightness(1.04)} .spinBtn:active{transform:translateY(1px)} .spinBtn:disabled{opacity:.6;cursor:not-allowed}
  
    .navBtn{
      border:1px solid rgba(255,255,255,.18);
      background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      color:var(--text);
      padding:12px 14px;
      border-radius:16px;
      font-weight:900;
      letter-spacing:.14em;
      text-transform:uppercase;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:10px;
      box-shadow:0 18px 55px rgba(0,0,0,.35);
      transition:transform .12s ease, filter .12s ease, background .12s ease;
      white-space:nowrap;
    }
    .navBtn:hover{filter:brightness(1.06)}
    .navBtn:active{transform:translateY(1px)}

  
    /* --- Mobile responsiveness --- */
    @media (max-width: 820px){
      body{ padding:12px; }
      .machine{ padding:16px; border-radius:24px; }
      .header{
        flex-wrap:wrap;
        justify-content:center;
        gap:10px;
        padding-bottom:14px;
      }
      .title{ text-align:center; letter-spacing:.08em; }
      .win{ min-width: 220px; padding:10px 12px; }
      .win .val{ font-size:28px; }
      .navBtn{
        width:100%;
        justify-content:center;
        letter-spacing:.10em;
      }

      .cabinet{ grid-template-columns:1fr; gap:14px; }
      .reelBox{ padding:14px; border-radius:24px; }
      .marquee{ height:40px; font-size:12px; margin-bottom:12px; }
      .reels{ gap:12px; }
      .window{ border-radius:20px; border-width:2px; }
      .frame{ border-radius:20px; }
      .payline{ height:4px; }

      .lever{
        min-height: 140px;
        padding:14px 12px 70px 12px;
        border-radius:24px;
      }
      .rail{
        width: 12px;
        height: 100%;
      }
      .knob{
        width:48px; height:48px;
        top: 10px;
      }
      .lever.pull .knob{ top: calc(100% - 62px); }
      .spinBtn{
        position:absolute;
        bottom:12px; left:12px; right:12px;
        padding:14px 10px;
        border-radius:18px;
        font-size:14px;
      }
    }

    @media (max-width: 520px){
      body{ padding:10px; }
      .machine{ width:100%; padding:14px; }
      .title{ font-size: clamp(20px, 6.5vw, 30px); }
      .win{ width:100%; min-width: unset; }
      .win .val{ font-size:26px; }

      .reels{
        grid-template-columns: 1fr;
        gap:10px;
      }
      .window{
        max-width: 420px;
        margin: 0 auto;
      }
      .lever{
        min-height: 120px;
      }
    }

    @media (max-width: 360px){
      .spinBtn{ letter-spacing:.12em; }
      .navBtn{ padding:10px 12px; }
    }
  </style>
</head>
<body>
  <section class="machine">
    <div class="header">
      <div class="title">FANTA SLOT</div>
      <a class="navBtn" href="https://pavoniingrifati.github.io/vetrina-carte/slot_premi" aria-label="Passa alla slot Solo dei premi">SLOT DEI PREMI</a>
      <div class="win"><div class="lbl">VINCITA</div><div class="val" id="lastWin">0000</div></div>
    </div>

    <div class="cabinet">
      <div class="reelBox">
        <div class="marquee">LUCKY CARDS</div>
        <div class="reels">
          <div class="window"><img class="img" id="reel0" alt="rullo 1"/><div class="payline"></div><div class="frame"></div></div>
          <div class="window"><img class="img" id="reel1" alt="rullo 2"/><div class="payline"></div><div class="frame"></div></div>
          <div class="window"><img class="img" id="reel2" alt="rullo 3"/><div class="payline"></div><div class="frame"></div></div>
        </div>
        <div class="flash" id="flash" aria-hidden="true"><div class="banner" id="flashText">+60</div></div>
      </div>

      <div class="lever" id="lever">
        <div class="rail"><div class="knob"></div></div>
        <button class="spinBtn" id="spinBtn">SPIN</button>
      </div>
    </div>
  </section>

<script>
const FIXED_SYMBOLS = [{"id": "Arthur-Morgan", "name": "Arthur Bronze", "rarityGroup": "Comune", "prize": 60, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/Arthur%20Morgan%20Bronze.png?raw=true"}, {"id": "Frazx0713", "name": "Frazx0713 Bronze", "rarityGroup": "Comune", "prize": 60, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/Frazx0713%20bronze.png?raw=true"}, {"id": "Nocera", "name": "Nocera Bronze", "rarityGroup": "Comune", "prize": 60, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/NOCERA%20GTA.png?raw=true"}, {"id": "Veledinovski", "name": "Veledinovski Bronze", "rarityGroup": "Comune", "prize": 60, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/Veledinovski%20Bronze.png?raw=true"}, {"id": "Edoardo", "name": "Edoardo  Bronze", "rarityGroup": "Comune", "prize": 60, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/Edoardo%20bronze.png?raw=true"}, {"id": "Ronny", "name": "Ronny Bronze", "rarityGroup": "Comune", "prize": 60, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/Ronny%20Bronze.png?raw=true"}, {"id": "Graziano", "name": "Graziano Bronze", "rarityGroup": "Comune", "prize": 60, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/Graziano.png?raw=true"}, {"id": "Marcoesmarco-Bronze", "name": "Marcoesmarco Bronze", "rarityGroup": "Comune", "prize": 60, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/Marcoesmarco.png?raw=true"}, {"id": "ElSpir1t", "name": "El Spirit Bronze", "rarityGroup": "Comune", "prize": 60, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/ElSpir1t%20bronze.png?raw=true"}, {"id": "Diegoal-bronze", "name": "Deigo Al Bronze", "rarityGroup": "Comune", "prize": 60, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/Diego%20al%20bronze.png?raw=true"}, {"id": "Damia-bronze", "name": "Damia Bronze", "rarityGroup": "Comune", "prize": 60, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/Damia%20bronze.png?raw=true"}, {"id": "Marca", "name": "Marca Bronze", "rarityGroup": "Comune", "prize": 60, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/marca%20(1).png?raw=true"}, {"id": "peps1zero-Gold", "name": "peps1zero Gold", "rarityGroup": "Non Comune", "prize": 140, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/peps1zero%20Gold.png?raw=true"}, {"id": "Flavio-gold", "name": "Flavio Gold", "rarityGroup": "Non Comune", "prize": 140, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/gold%20rare%20Flavio.png?raw=true"}, {"id": "Mattiagree-gold", "name": "Mattia Grr Gold", "rarityGroup": "Non Comune", "prize": 140, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main//Mattia%20grr%20gold.png?raw=true"}, {"id": "Solitario-Gold", "name": "Solitario Gold", "rarityGroup": "Non Comune", "prize": 140, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/Il%20solitario.png?raw=true"}, {"id": "Gigachad-Gold", "name": "Gigachad Gold", "rarityGroup": "Non Comune", "prize": 140, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/gigachad.png?raw=true"}, {"id": "Frank-TOTS12", "name": "Frank Tots12", "rarityGroup": "Rara", "prize": 260, "img": "img/Frank%20Tots12.png"}, {"id": "Attilo-Tots7", "name": "Accardi Tots7", "rarityGroup": "Rara", "prize": 260, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/Attilio%20tots7.png?raw=true"}, {"id": "Tore-Tots7", "name": "Tore Tots7", "rarityGroup": "Rara", "prize": 260, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/Tore%20tots7.png?raw=true"}, {"id": "Maks-Tots3", "name": "Maks Tots3", "rarityGroup": "Rara", "prize": 260, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/Maxx%20tots3.png?raw=true"}, {"id": "Balasco-Pokemon", "name": "Balasco Pokemon", "rarityGroup": "Epica", "prize": 420, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/bALASCO%20ev-3.png?raw=true"}, {"id": "Fiorin-Pokemon", "name": "Fiorin Pokemon", "rarityGroup": "Epica", "prize": 420, "img": "https://github.com/pavoniingrifati/vetrina-carte/blob/main/Bruno%20Fiorin%20Ev3.png?raw=true"}, {"id": "Fork-Hall", "name": "Fork Hall of Fame", "rarityGroup": "Leggendaria", "prize": 1000, "img": "img/Fork%20hall.png"}];

// --- SUONI DEFAULT (Web Audio API) ---
let audioCtx = null;
function ensureAudio(){
  if (!audioCtx){
    const Ctx = window.AudioContext || window.webkitAudioContext;
    audioCtx = Ctx ? new Ctx() : null;
  }
  if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume().catch(()=>{});
  return audioCtx;
}
function tone({freq=440, type='sine', duration=0.08, gain=0.12, sweepTo=null} = {}){
  const ctx = ensureAudio(); if (!ctx) return;
  const now = ctx.currentTime;
  const o = ctx.createOscillator(); const g = ctx.createGain();
  o.type = type; o.frequency.setValueAtTime(freq, now);
  if (sweepTo != null) o.frequency.exponentialRampToValueAtTime(Math.max(1, sweepTo), now + duration);
  g.gain.setValueAtTime(0.0001, now);
  g.gain.exponentialRampToValueAtTime(gain, now + 0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, now + duration);
  o.connect(g); g.connect(ctx.destination);
  o.start(now); o.stop(now + duration + 0.02);
}
function playSpinStart(){ tone({freq:220, type:'sawtooth', duration:0.18, gain:0.10, sweepTo:70}); }
function playReelStop(){ tone({freq:900, type:'square', duration:0.035, gain:0.08, sweepTo:650}); }
function playWin(){ const ctx = ensureAudio(); if (!ctx) return;
  const notes = [523.25, 659.25, 783.99];
  notes.forEach((f,i)=>setTimeout(()=>tone({freq:f, type:'triangle', duration:0.11, gain:0.10}), i*95));
}
function playLose(){ tone({freq:140, type:'triangle', duration:0.12, gain:0.10, sweepTo:95}); }

// --- STATE ---
const STATE = {
  symbols: FIXED_SYMBOLS,
  spinning: false,
  lastWin: 0
};

const $ = (s)=>document.querySelector(s);
const reels = [$('#reel0'), $('#reel1'), $('#reel2')];

function pad4(n){ const s=String(Math.max(0, Math.floor(n||0))); return s.padStart(4,'0').slice(-4); }
function setDisplay(){ $('#lastWin').textContent = pad4(STATE.lastWin); }

function pickSymbol(){ 
  const a = STATE.symbols;
  return a[Math.floor(Math.random()*a.length)];
}

function flash(text){
  const f = $('#flash'); const txt = $('#flashText');
  txt.textContent = text;
  f.classList.add('show'); f.setAttribute('aria-hidden','false');
  setTimeout(()=>{ f.classList.remove('show'); f.setAttribute('aria-hidden','true'); }, 850);
}

function preloadSymbols(symbols){
  const unique = new Map();
  for (const s of symbols) unique.set(s.img, true);
  for (const url of unique.keys()) {
    const im = new Image(); im.decoding = 'async'; im.src = url;
  }
}

function sameSymbol(a,b,c){
  const ida = a.id ?? a.img ?? a.name;
  const idb = b.id ?? b.img ?? b.name;
  const idc = c.id ?? c.img ?? c.name;
  return Boolean(ida) && ida===idb && idb===idc;
}

function sameRarity(a,b,c){
  const ra = a.rarityGroup || '';
  const rb = b.rarityGroup || '';
  const rc = c.rarityGroup || '';
  return ra && ra === rb && rb === rc;
}

// Premio se escono 3 carte della STESSA rarità (ma NON tutte uguali)
const RARITY_MATCH_PRIZE = {
  'Comune': 20,
  'Non Comune': 50,
  'Rara': 90,
  'Epica': 150,
  'Leggendaria': 250
};

function rarityPrize(r){
  return RARITY_MATCH_PRIZE[r] ?? 50;
}

async function spin(){
  if (STATE.spinning) return;
  if (STATE.symbols.length < 3) return;

  STATE.spinning = true;
  $('#spinBtn').disabled = true;

  const lever = $('#lever');
  lever.classList.add('pull');
  playSpinStart();

  const final = [pickSymbol(), pickSymbol(), pickSymbol()];

  const durations = [900, 1200, 1500];
  const intervalMs = 65;

  const timers = reels.map((imgEl)=>{
    return setInterval(()=>{ imgEl.src = pickSymbol().img; }, intervalMs);
  });

  durations.forEach((d, idx)=>{
    setTimeout(()=>{
      clearInterval(timers[idx]);
      reels[idx].src = final[idx].img;
      playReelStop();

      if (idx === 2) {
        lever.classList.remove('pull');
        let win = 0;

// 1) Jackpot: 3 carte uguali (stessa carta) -> premio pieno (60..1000)
if (sameSymbol(final[0], final[1], final[2])) {
  win = (final[0].prize || 60);
}
// 2) Consolazione: 3 carte della stessa rarità -> premio ridotto
else if (sameRarity(final[0], final[1], final[2])) {
  win = rarityPrize(final[0].rarityGroup);
}
        STATE.lastWin = win;
        setDisplay();
        if (win > 0) {
          const isJackpot = sameSymbol(final[0], final[1], final[2]);
          flash((isJackpot ? 'JACKPOT +' : '+') + win);
          playWin();
        } else {
          flash('NO WIN');
          playLose();
        }
        STATE.spinning = false;
        $('#spinBtn').disabled = false;
      }
    }, d);
  });
}

function wire(){
  $('#spinBtn').addEventListener('click', spin);
  $('#lever').addEventListener('click', (e)=>{
    if (e.target && (e.target.id==='lever' || e.target.classList.contains('rail') || e.target.classList.contains('knob'))) spin();
  });
}

wire();
setDisplay();
const init = [pickSymbol(), pickSymbol(), pickSymbol()];
reels.forEach((img,i)=> img.src = init[i].img);
preloadSymbols(STATE.symbols);
</script>
</body>
</html>
