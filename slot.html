<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Slot Premi</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@700;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#050814; --border: rgba(255,255,255,.16); --text:#eef3ff; --gold:#ffd36a;
      --shadow: 0 24px 90px rgba(0,0,0,.65); --r:34px;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(1200px 800px at 20% -10%, rgba(255,211,106,.18), transparent 62%),
        radial-gradient(1200px 800px at 120% 10%, rgba(255,77,109,.10), transparent 62%),
        radial-gradient(1200px 800px at 50% 110%, rgba(77,255,184,.10), transparent 62%),
        var(--bg);
      color:var(--text); display:grid; place-items:center; padding:18px;
    }

    .machine{
      width:min(1600px, 98vw); border-radius:var(--r);
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      border:1px solid var(--border); box-shadow:var(--shadow);
      overflow:hidden; position:relative; padding:26px;
    }
    .machine::before{content:"";position:absolute;inset:-60%;
      background:conic-gradient(from 120deg, rgba(255,255,255,0), rgba(255,255,255,.18), rgba(255,255,255,0));
      animation:shine 11s linear infinite; opacity:.20; pointer-events:none;
    }
    @keyframes shine{to{transform:rotate(360deg)}}

    .header{position:relative;display:flex;justify-content:space-between;align-items:center;gap:14px;padding-bottom:18px;z-index:1;}
    .title{font-size:clamp(22px, 2.8vw, 44px);font-weight:900;letter-spacing:.10em;text-transform:uppercase;text-shadow:0 14px 55px rgba(0,0,0,.45);}
    .sub{opacity:.78;font-weight:800;letter-spacing:.06em}

    .cabinet{position:relative;z-index:1;display:grid;grid-template-columns:1fr 120px;gap:18px;align-items:stretch;}
    @media(max-width:980px){.cabinet{grid-template-columns:1fr;} .lever{min-height:140px}}

    .reelBox{background:linear-gradient(180deg, rgba(0,0,0,.30), rgba(0,0,0,.16));
      border:1px solid rgba(255,255,255,.16);border-radius:30px;padding:20px;position:relative;overflow:hidden;}
    .marquee{height:44px;border-radius:22px;display:flex;align-items:center;justify-content:center;
      background:linear-gradient(90deg, rgba(255,77,109,.20), rgba(255,211,106,.22), rgba(77,255,184,.16));
      border:1px solid rgba(255,255,255,.12);font-weight:900;letter-spacing:.18em;text-transform:uppercase;font-size:13px;margin-bottom:16px;}
    .reels{display:grid;grid-template-columns:repeat(3, 1fr);gap:18px;align-items:stretch;}
    .window{border-radius:26px;border:3px solid rgba(255,255,255,.16);background:rgba(0,0,0,.32);
      overflow:hidden;aspect-ratio:690/987;position:relative;box-shadow:inset 0 0 0 3px rgba(0,0,0,.35);}
    .img{width:100%;height:100%;object-fit:cover;display:block;background:#070b18;transform:translateZ(0);}
    .payline{position:absolute;left:7%;right:7%;top:50%;height:5px;transform:translateY(-50%);
      background:linear-gradient(90deg, transparent, rgba(255,211,106,.98), transparent);
      filter:drop-shadow(0 0 14px rgba(255,211,106,.6));opacity:.98;pointer-events:none;}
    .frame{position:absolute;inset:0;border-radius:26px;box-shadow:inset 0 0 0 2px rgba(255,255,255,.08), inset 0 -90px 120px rgba(0,0,0,.42);pointer-events:none;}

    .lever{border-radius:30px;background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.14);display:flex;align-items:center;justify-content:center;padding:18px 12px;position:relative;overflow:hidden;min-height:520px;}
    .rail{width:16px;height:100%;border-radius:999px;background:linear-gradient(180deg, #cfd6ea, #6b7692);
      box-shadow:inset 0 0 0 1px rgba(0,0,0,.35), 0 18px 48px rgba(0,0,0,.35);position:relative;}
    .knob{width:56px;height:56px;border-radius:999px;background:radial-gradient(circle at 30% 30%, #fff, #ff7a92 40%, #c71f43 72%);
      box-shadow:0 18px 38px rgba(0,0,0,.45), inset 0 0 0 2px rgba(255,255,255,.18);
      position:absolute;left:50%;transform:translateX(-50%);top:18px;transition:top .18s ease;}
    .lever.pull .knob{top:calc(100% - 74px);}
    .spinBtn{position:absolute;bottom:14px;left:14px;right:14px;border:0;cursor:pointer;padding:16px 10px;border-radius:20px;
      font-weight:900;letter-spacing:.18em;text-transform:uppercase;color:#08101c;
      background:linear-gradient(135deg, var(--gold), rgba(255,211,106,.65));box-shadow:0 18px 55px rgba(0,0,0,.45);
      transition:transform .12s ease, filter .12s ease, opacity .12s ease;}
    .spinBtn:hover{filter:brightness(1.04)} .spinBtn:active{transform:translateY(1px)} .spinBtn:disabled{opacity:.6;cursor:not-allowed}

    /* Win popup */
    .popup{
      position:absolute; inset:0;
      display:grid; place-items:center;
      background:rgba(0,0,0,.35);
      opacity:0; pointer-events:none;
      transition:opacity .18s ease;
      z-index:5;
    }
    .popup.show{opacity:1; pointer-events:auto;}
    .card{
      width:min(560px, 92vw);
      border-radius:26px;
      border:1px solid rgba(255,255,255,.18);
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      box-shadow:0 22px 70px rgba(0,0,0,.6);
      padding:16px;
      display:grid;
      grid-template-columns: 160px 1fr;
      gap:14px;
      align-items:center;
    }
    .thumb{width:160px; aspect-ratio:690/987; border-radius:18px; object-fit:cover; border:1px solid rgba(255,255,255,.12); background:#070b18;}
    .txt h2{margin:0;font-size:20px;letter-spacing:.06em}
    .pill{display:inline-flex;margin-top:8px;padding:6px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14); background:rgba(0,0,0,.22);
      font-weight:900; letter-spacing:.12em; text-transform:uppercase; font-size:12px; opacity:.9}
    .ok{
      margin-top:12px;
      border:0; cursor:pointer;
      padding:10px 12px;
      border-radius:14px;
      font-weight:900;
      letter-spacing:.10em;
      text-transform:uppercase;
      background:linear-gradient(135deg, rgba(255,255,255,.22), rgba(255,255,255,.10));
      color:var(--text);
    }
  
    .navBtn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding:12px 14px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.16);
      background:linear-gradient(135deg, rgba(255,255,255,.18), rgba(255,255,255,.08));
      color:var(--text);
      text-decoration:none;
      font-weight:900;
      letter-spacing:.08em;
      text-transform:uppercase;
      box-shadow:0 16px 45px rgba(0,0,0,.35);
      white-space:nowrap;
    }
    .navBtn:hover{filter:brightness(1.05)}
    .navBtn:active{transform:translateY(1px)}
  </style>
</head>
<body>
  <section class="machine">
    <div class="header">
      <div>
        <div class="title">SLOT PREMI</div>
        <div class="sub">Vinci solo con <b>3 carte uguali</b>.</div>
      <a class="navBtn" href="https://pavoniingrifati.github.io/vetrina-carte/slot_premi" target="_blank" rel="noopener">Ruota dei Premii</a>
      </div>
    </div>

    <div class="cabinet">
      <div class="reelBox">
        <div class="marquee">PRIZE SPIN</div>
        <div class="reels">
          <div class="window"><img class="img" id="reel0" alt="rullo 1"/><div class="payline"></div><div class="frame"></div></div>
          <div class="window"><img class="img" id="reel1" alt="rullo 2"/><div class="payline"></div><div class="frame"></div></div>
          <div class="window"><img class="img" id="reel2" alt="rullo 3"/><div class="payline"></div><div class="frame"></div></div>
        </div>
      </div>

      <div class="lever" id="lever">
        <div class="rail"><div class="knob"></div></div>
        <button class="spinBtn" id="spinBtn">SPIN</button>
      </div>
    </div>

    <div class="popup" id="popup" aria-hidden="true">
      <div class="card">
        <img class="thumb" id="prizeImg" alt="premio"/>
        <div class="txt">
          <h2 id="prizeName">Hai vinto!</h2>
          <div class="pill" id="prizeRarity">RARITÃ€</div>
          <button class="ok" id="closeBtn">OK</button>
        </div>
      </div>
    </div>
  </section>

<script>
const SYMBOLS = [{"id": "bronzo", "name": "Pacchetto bronzo", "rarity": "Comune", "img": "Deck%20back%20bronzo.png", "weight": 50}, {"id": "silver", "name": "Pacchetto silver", "rarity": "Comune", "img": "Deck%20back%20argento.png", "weight": 50}, {"id": "cosmetic", "name": "Cosmetic", "rarity": "Comune", "img": "Deck%20back%20cosmetic.png", "weight": 50}, {"id": "patatine", "name": "Patatine", "rarity": "Comune", "img": "Patatine.png", "weight": 50}, {"id": "gold", "name": "Pacchetto Gold", "rarity": "Non comune", "img": "Deck%20back%20ORO.png", "weight": 12}, {"id": "tots", "name": "Pacchetto Tots", "rarity": "Raro", "img": "Deck%20back%20Tots.png", "weight": 6}, {"id": "mese", "name": "Pacco del mese", "rarity": "Raro", "img": "Deck%20back%20wonderkid.png", "weight": 6}, {"id": "legend", "name": "Pacchetto Legend", "rarity": "Leggendario", "img": "Back%20legend.png", "weight": 1}];

const STATE = {
  spinning: false
};

const $ = (s)=>document.querySelector(s);
const reels = [$('#reel0'), $('#reel1'), $('#reel2')];

function pickSymbol(){
  const total = SYMBOLS.reduce((a,s)=>a + (Number(s.weight)||0), 0);
  let r = Math.random() * (total || 1);
  for (const s of SYMBOLS){
    r -= (Number(s.weight)||0);
    if (r <= 0) return s;
  }
  return SYMBOLS[SYMBOLS.length - 1];
}

function sameSymbol(a,b,c){
  const ida = a.id ?? a.img ?? a.name;
  const idb = b.id ?? b.img ?? b.name;
  const idc = c.id ?? c.img ?? c.name;
  return Boolean(ida) && ida===idb && idb===idc;
}

function preloadSymbols(){
  const seen = new Set();
  for (const s of SYMBOLS){
    if (seen.has(s.img)) continue;
    seen.add(s.img);
    const im = new Image();
    im.decoding = 'async';
    im.src = s.img;
    // if missing, fallback to placeholder
    im.onerror = ()=>{};
  }
}

function showPrize(sym){
  $('#prizeImg').src = sym.img || '';
  $('#prizeName').textContent = sym.name || 'Premio';
  $('#prizeRarity').textContent = String(sym.rarity || '').toUpperCase();
  const p = $('#popup');
  p.classList.add('show');
  p.setAttribute('aria-hidden','false');
}

function hidePrize(){
  const p = $('#popup');
  p.classList.remove('show');
  p.setAttribute('aria-hidden','true');
}

async function spin(){
  if (STATE.spinning) return;
  STATE.spinning = true;
  $('#spinBtn').disabled = true;

  const lever = $('#lever');
  lever.classList.add('pull');

  const final = [pickSymbol(), pickSymbol(), pickSymbol()];

  // fast classic spin animation: swap src quickly, then stop one by one
  const durations = [850, 1150, 1450];
  const intervalMs = 70;

  const timers = reels.map((imgEl)=> setInterval(()=>{ imgEl.src = pickSymbol().img; }, intervalMs));

  durations.forEach((d, idx)=>{
    setTimeout(()=>{
      clearInterval(timers[idx]);
      reels[idx].src = final[idx].img;

      if (idx === 2) {
        lever.classList.remove('pull');

        if (sameSymbol(final[0], final[1], final[2])) {
          showPrize(final[0]);
        }

        STATE.spinning = false;
        $('#spinBtn').disabled = false;
      }
    }, d);
  });
}

function wire(){
  $('#spinBtn').addEventListener('click', spin);
  $('#lever').addEventListener('click', (e)=>{
    if (e.target && (e.target.id==='lever' || e.target.classList.contains('rail') || e.target.classList.contains('knob'))) spin();
  });
  $('#closeBtn').addEventListener('click', hidePrize);
  $('#popup').addEventListener('click', (e)=>{ if (e.target && e.target.id==='popup') hidePrize(); });
}

wire();

// init visuals
const init = [pickSymbol(), pickSymbol(), pickSymbol()];
reels.forEach((img,i)=> img.src = init[i].img);

// preload
preloadSymbols();
</script>
</body>
</html>
