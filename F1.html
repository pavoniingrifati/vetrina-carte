<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Il mio campionato ‚Äì F1, F2, F3 (F1.html)</title>
  <meta name="description" content="Sito demo per campionato personale di Formula 1, Formula 2 e Formula 3. Squadre, piloti, classifiche, regole e calendario." />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 256'%3E%3Cpath fill='%23ff1a1a' d='M17 169c0-42 34-76 76-76h75c39 0 71 30 75 68c1 8-5 15-13 15H134c-9 0-16-7-16-16s7-16 16-16h86c-5-18-22-32-42-32H93c-25 0-46 21-46 46s21 46 46 46h127c9 0 16 7 16 16s-7 16-16 16H93c-42 0-76-34-76-76Z'/%3E%3C/svg%3E"/>
  <style>
    /* ======= Design System (CSS variables) ======= */
    :root { --bg:#0b0c0f; --panel:#12141a; --panel-2:#1a1d25; --text:#e6e8f0; --muted:#9aa2b1; --brand:#ff1a1a; --brand-2:#ff6b6b; --ok:#1dd1a1; --warn:#ffd166; --shadow:0 10px 30px rgba(0,0,0,.45); --radius:16px; --radius-sm:10px; --gap:18px; --gap-lg:28px; --maxw:1200px; }
    @media (prefers-color-scheme: light){ :root{ --bg:#f7f8fb; --panel:#ffffff; --panel-2:#f1f3f7; --text:#0d0f14; --muted:#4c5463; } }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{ margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji; color:var(--text); background:linear-gradient(180deg, var(--bg), #0b0c0f 60%);} a{color:inherit}

    /* ======= Layout ======= */
    header{ position:sticky; top:0; z-index:50; backdrop-filter:saturate(140%) blur(8px); background: linear-gradient(180deg, rgba(10,10,14,.9), rgba(10,10,14,.6)); border-bottom:1px solid rgba(255,255,255,.06); }
    .wrap{max-width:var(--maxw); margin-inline:auto; padding: 16px 22px;}
    .hero{display:flex; align-items:center; gap:16px}
    .logo{width:36px; height:36px; border-radius:10px; background: radial-gradient(120% 120% at 20% 20%, var(--brand-2), var(--brand)); box-shadow: var(--shadow)}
    .title{font-size: clamp(18px, 2.2vw, 26px); font-weight:800; letter-spacing:.3px;}
    .subtitle{font-size:14px; color:var(--muted)}

    /* Tabs */
    .tabs{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    .tab{padding:10px 14px; border:1px solid rgba(255,255,255,.08); border-radius:999px; background:var(--panel-2); cursor:pointer; user-select:none; transition:.2s transform}
    .tab[aria-selected="true"]{outline:2px solid var(--brand); box-shadow:0 0 0 4px rgba(255,26,26,.18) inset}
    .tab:active{transform:translateY(1px)}

    main{max-width:var(--maxw); margin: 18px auto; padding: 0 22px; display:grid; grid-template-columns: 1.4fr .9fr; gap: var(--gap-lg)}
    @media (max-width: 980px){ main{ grid-template-columns: 1fr; } }

    .card{background:var(--panel); border:1px solid rgba(255,255,255,.06); border-radius:var(--radius); box-shadow:var(--shadow);} .card h2{margin:0 0 10px; font-size: clamp(18px,2vw,22px)} .card .hd{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:16px 18px; border-bottom:1px solid rgba(255,255,255,.06)} .card .bd{padding:18px}

    /* Teams grid */
    .grid{display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap:var(--gap)} @media (max-width:720px){ .grid{ grid-template-columns: 1fr; } }
    .team{display:flex; gap:14px; background:var(--panel-2); border:1px solid rgba(255,255,255,.07); border-radius:var(--radius-sm); padding:12px; align-items:center; position:relative; overflow:hidden}
    .team::before{content:""; position:absolute; left:0; top:0; bottom:0; width:6px; background:var(--team, rgba(255,255,255,.12));}
    .team img.logo{width:58px; height:58px; border-radius:12px}
    
/* MINI F1 top-down */
.car{width:58px; height:58px; flex:0 0 auto; display:block}
.car .body{ fill: var(--team, #1a1f2e) }       /* scocca */
.car .aero{ fill: #0a0d12 }                    /* ali / fondo / sospensioni */
.car .trim{ fill: color-mix(in srgb, var(--team, #1a1f2e) 65%, #ffffff 35%) } /* riflessi */
.car .tyre{ fill:#1a1f2a }                     /* gomme */
.car .rim{ fill:#cbd5e1 }                      /* cerchi */


    .team .name{display:inline-block; padding:6px 10px; border-radius:10px; font-weight:800; background: var(--team, #1a1f2e); color:#fff}
    .team .owner{margin-top:6px; font-size:12px; color:var(--muted)}
    .team .meta{font-size:12px; color:var(--muted)}
    .drivers{display:flex; gap:10px; margin-top:6px; flex-wrap:wrap}
    .drv{display:flex; align-items:center; gap:8px; background:#00000020; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.06)}
    .drv img{width:22px; height:22px; border-radius:999px}

    /* ===== Track background & grid styling ===== */
    .grid.track{position:relative; padding:18px; border-radius:var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.08)),
                  repeating-linear-gradient(0deg, #141821 0 18px, #121620 18px 36px);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
    }
    .grid.track::after{content:""; position:absolute; top:0; bottom:0; left:50%; width:2px;
      background: repeating-linear-gradient(to bottom, rgba(255,255,255,.65) 0 10px, transparent 10px 20px);
      opacity:.6; filter:blur(.2px);
    }
    .team.stagger:nth-child(even){ margin-top:24px }
    @media (max-width:720px){ .team.stagger:nth-child(even){ margin-top:0 } }
    .pos{ position:absolute; top:8px; right:8px; font-weight:800; font-size:12px; padding:4px 8px; border-radius:999px; background:rgba(0,0,0,.5); border:1px solid rgba(255,255,255,.25) }

    /* Tables */
    table{width:100%; border-collapse: collapse}
    th, td{padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.06); text-align:left; font-size:14px}
    th{font-size:12px; text-transform:uppercase; letter-spacing:.8px; color:var(--muted)}
    tr:hover td{background:rgba(255,255,255,.03)}
    .tag{font-size:12px; padding:4px 8px; border-radius:999px; background:#00000020; border:1px solid rgba(255,255,255,.06)}

    /* Calendar pills */
    .chips{display:flex; gap:8px; flex-wrap:wrap}
    .chip{padding:8px 12px; border-radius:999px; background:var(--panel-2); border:1px solid rgba(255,255,255,.07); font-size:13px}

    /* Footer */
    footer{max-width:var(--maxw); margin: 0 auto 40px; padding: 0 22px}
    .foot{display:flex; gap:10px; align-items:center; justify-content:space-between; color:var(--muted); font-size:13px}

    /* Toggle */
    .toggle{display:flex; align-items:center; gap:8px}
    .switch{appearance:none; width:42px; height:26px; border-radius:999px; background:#111; position:relative; border:1px solid rgba(255,255,255,.2); cursor:pointer}
    .switch::after{content:""; position:absolute; top:2px; left:2px; width:20px; height:20px; border-radius:50%; background:var(--brand); transition:.2s}
    .switch:checked::after{left:20px}

    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="hero" role="banner">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <div class="title">FANTABALLA F1, F2, F3</div>
          <div class="subtitle">Partecipa anche tu! Acquista una scuderia o diventa pilota!</div>
        </div>
        <div style="margin-left:auto" class="toggle">
          <label for="dm" class="sr-only">Tema scuro</label>
          <input id="dm" class="switch" type="checkbox" aria-label="Tema scuro" />
        </div>
      </div>
      <nav class="tabs" role="tablist" aria-label="Seleziona categoria">
        <button class="tab" role="tab" aria-selected="true" data-series="F1">Formula 1</button>
        <button class="tab" role="tab" aria-selected="false" data-series="F2">Formula 2</button>
        <button class="tab" role="tab" aria-selected="false" data-series="F3">Formula 3</button>
      </nav>
    </div>
  </header>

  <main>
    <!-- Teams -->
    <section id="teams" class="card" aria-labelledby="teams-h">
      <div class="hd">
        <h2 id="teams-h">Scuderie e piloti</h2>
        <div class="tag" id="seriesTag">F1</div>
      </div>
      <div class="bd">
        <div id="teamsGrid" class="grid track" aria-live="polite"></div>
      </div>
    </section>

    <section class="side">
      <!-- Rules -->
      <section id="rules" class="card" aria-labelledby="rules-h">
        <div class="hd"><h2 id="rules-h">Regole stagione</h2></div>
        <div class="bd" id="rulesBox"></div>
      </section>

      <!-- Standings drivers -->
      <section id="standingsDrivers" class="card" aria-labelledby="stand-d-h">
        <div class="hd"><h2 id="stand-d-h">Classifica Piloti</h2></div>
        <div class="bd">
          <table id="tblDrivers">
            <thead><tr><th>#</th><th>Pilota</th><th>Scuderia</th><th>Punti</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Standings teams -->
      <section id="standingsTeams" class="card" aria-labelledby="stand-t-h">
        <div class="hd"><h2 id="stand-t-h">Classifica Scuderie</h2></div>
        <div class="bd">
          <table id="tblTeams">
            <thead><tr><th>#</th><th>Scuderia</th><th>Punti</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Calendar -->
      <section id="calendar" class="card" aria-labelledby="cal-h">
        <div class="hd"><h2 id="cal-h">Calendario</h2></div>
        <div class="bd"><div id="chips" class="chips"></div></div>
      </section>
    </section>
  </main>

  <footer>
    <div class="foot">
      <div>üìÅ Salva questo file come <strong>F1.html</strong> e crea <code>piloti.json</code> nella stessa cartella.</div>
      <div>üõ†Ô∏è Loghi e avatar sono placeholder: sostituisci gli URL quando vuoi.</div>
    </div>
  </footer>

  <script>
    /* =======================================================
       DATI: i piloti ora arrivano da piloti.json (categoria, scuderia, piloti[ {nome, skill} ])
       - Manteniamo qui REGOLE e CALENDARI (per serie) e i PUNTI TOTALI SCUDERIA.
       ======================================================= */
    const RULES = {
      F1: { punti: [22,21,20,19,18,17,16,15,14,13], puntoGiroVeloce: true, numeroGare: 16, ultimaGaraDoppioPunteggio: false, note: "Tutti i piloti vanno a punti" },
      F2: { punti: [22,21,20,19,18,17,16,15,14,13], puntoGiroVeloce: false, numeroGare: 6, ultimaGaraDoppioPunteggio: false, note: "Tutti i piloti vanno a punti" },
      F3: { punti: [30,29,28,27,26,25,24,23,22], puntoGiroVeloce: false, numeroGare: 6, ultimaGaraDoppioPunteggio: false, note: "Tutti i piloti vanno a punti" }
    };

    const CALENDAR = {
      F1: [
        "Silverstone International", "Laguna Seca",
        "Laguna Seca", "Monaco",
        "Silverstone GP", "Jedda",
        "Black Cat Short", "Corso Speed",
        "Brands Hatch GP", "Spa",
        "Abu Dabu", "Highlands Drift",
        "San paolo", "Imola",
         "Nurbugring Gp", " ",
         "Vallelunga Gp"
        
      ],
      F2: [
        "Silverstone International", "Laguna Seca",
        "Laguna Seca", "Monaco",
        "Silverstone GP", "Jedda",
        "Black Cat Short", "Corso Speed",
        "Brands Hatch GP", "Spa",
        "Abu Dabu", "Highlands Drift",
        "San paolo", "Imola",
         "Nurbugring Gp", " ",
         "Vallelunga Gp"
        
      ],
      F3: [
       "Silverstone International", "Laguna Seca",
        "Laguna Seca", "Monaco",
        "Silverstone GP", "Jedda",
        "Black Cat Short", "Corso Speed",
        "Brands Hatch GP", "Spa",
        "Abu Dabu", "Highlands Drift",
        "San paolo", "Imola",
         "Nurbugring Gp", " ",
         "Vallelunga Gp"
        
      ]
    };

    // Punti totali scuderia (placeholder): modifica liberamente o collegalo a un file separato
    
    // Stato applicazione popolato da piloti.json
    const state = { dataBySeries: { F1: new Map(), F2: new Map(), F3: new Map() } };

    const el = sel => document.querySelector(sel);
    const teamsGrid = el('#teamsGrid');
    const tblDrivers = el('#tblDrivers tbody');
    const tblTeams = el('#tblTeams tbody');
    const chips = el('#chips');
    const rulesBox = el('#rulesBox');
    const seriesTag = el('#seriesTag');

    // === Numeri robusti: accetta "80,5" oltre a 80.5 ===
    function toNum(v){
      if(typeof v === 'number') return v;
      if(typeof v === 'string'){
        const s = v.trim().replace(/\./g,'').replace(',', '.'); // rimuove separatori migliaia IT e converte virgola in punto
        const n = Number(s);
        return Number.isFinite(n) ? n : 0;
      }
      return 0;
    }
    function formatNumber(n){
      const x = Number(n);
      return Number.isFinite(x) && typeof Intl !== 'undefined'
        ? x.toLocaleString('it-IT', { maximumFractionDigits: 2 })
        : n;
    }

    let current = 'F1';
    const tabs = [...document.querySelectorAll('.tab')];
    tabs.forEach(b => b.addEventListener('click', () => {
      tabs.forEach(t => t.setAttribute('aria-selected', 'false'));
      b.setAttribute('aria-selected', 'true');
      current = b.dataset.series;
      seriesTag.textContent = current;
      render();
    }));

    // Tema scuro/chiaro
    const themeSwitch = el('#dm');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    themeSwitch.checked = prefersDark;
    themeSwitch.addEventListener('change', () => {
      document.documentElement.style.filter = themeSwitch.checked ? 'none' : 'invert(0)';
      document.body.classList.toggle('light', !themeSwitch.checked);
    });
// SVG mini F1 (top-down, stile reale)
function carSVG(){
  return `
  <svg class="car" viewBox="0 0 200 300" aria-hidden="true" focusable="false" role="img">
    <!-- GOMME -->
    <circle class="tyre" cx="40" cy="70" r="22"/><circle class="rim" cx="40" cy="70" r="8"/>
    <circle class="tyre" cx="160" cy="70" r="22"/><circle class="rim" cx="160" cy="70" r="8"/>
    <circle class="tyre" cx="40" cy="240" r="22"/><circle class="rim" cx="40" cy="240" r="8"/>
    <circle class="tyre" cx="160" cy="240" r="22"/><circle class="rim" cx="160" cy="240" r="8"/>

    <!-- SOSPENSIONI -->
    <path class="aero" d="M60 80 L100 120 L90 130 L50 90 Z"/>
    <path class="aero" d="M140 80 L100 120 L110 130 L150 90 Z"/>
    <path class="aero" d="M60 230 L100 190 L90 180 L50 220 Z"/>
    <path class="aero" d="M140 230 L100 190 L110 180 L150 220 Z"/>

    <!-- ALA POSTERIORE -->
    <rect class="aero" x="35" y="10" width="130" height="30" rx="6"/>

    <!-- FONDO PIATTO -->
    <rect class="aero" x="70" y="60" width="60" height="180" rx="18"/>

    <!-- SCOCCA PRINCIPALE -->
    <path class="body" d="
      M100 30
      C 96 50, 92 95, 92 120
      L 92 210
      C 92 240, 96 260, 100 270
      C 104 260, 108 240, 108 210
      L 108 120
      C 108 95, 104 50, 100 30 Z" />

    <!-- Naso affusolato -->
    <path class="body" d="M100 30 C88 40, 84 56, 84 78 L84 120 L116 120 L116 78 C116 56, 112 40, 100 30 Z"/>

    <!-- Pance -->
    <path class="body" d="M60 150 C 70 130, 85 120, 92 120 L92 200 C 80 198, 70 188, 64 176 C 60 168, 58 160, 60 150 Z"/>
    <path class="body" d="M140 150 C 130 130, 115 120, 108 120 L108 200 C 120 198, 130 188, 136 176 C 140 168, 142 160, 140 150 Z"/>

    <!-- Halo / cockpit -->
    <ellipse class="aero" cx="100" cy="135" rx="22" ry="18"/>
    <rect class="aero" x="96" y="84" width="8" height="48" rx="4"/>

    <!-- Airbox -->
    <ellipse class="aero" cx="100" cy="110" rx="12" ry="10"/>

    <!-- ALA ANTERIORE -->
    <rect class="aero" x="30" y="260" width="140" height="24" rx="6"/>
    <rect class="aero" x="36" y="250" width="128" height="6" rx="3"/>

    <!-- Riflessi -->
    <path class="trim" d="M97 50 C 94 90, 94 160, 97 210" />
    <path class="trim" d="M103 50 C 106 90, 106 160, 103 210" />
  </svg>`;
}



    function render(){
      const data = state.dataBySeries[current];

      // Teams grid
      teamsGrid.innerHTML = '';
      const list = [...data.entries()].map(([teamName, team]) => {
        const drivers = (team && team.piloti) ? team.piloti : [];
        const color = team && team.colore ? team.colore : null;
        const teamPoints = (drivers || []).reduce((s,dr)=> s + (dr.punti||0), 0);
        return { teamName, team, drivers, color, teamPoints };
      }).sort((a,b)=> b.teamPoints - a.teamPoints || a.teamName.localeCompare(b.teamName));

      list.forEach((row, idx) => {
        const { teamName, drivers, color, teamPoints } = row;
        const card = document.createElement('article');
        card.className = 'team stagger';
        if(color){ card.style.setProperty('--team', color); card.style.borderColor = color; }
        const logoUrl = `https://placehold.co/200x200/1a1f2e/ffffff?text=${encodeURIComponent(teamName)}`;
        card.innerHTML = `
          ${carSVG()}
          <div style="flex:1 1 auto">
            <div class="name">${teamName}</div>
                        ${row.team && row.team.proprietario ? `<div class=\"owner\">Proprietario: <strong>${Array.isArray(row.team.proprietario) ? row.team.proprietario.join(', ') : row.team.proprietario}</strong></div>` : ``}
            <div class="meta">Totale scuderia: <strong>${formatNumber(teamPoints)}</strong> pt</div>
            <div class="drivers">
              ${drivers.map(dr => `
                <span class="drv">
                  <img src="https://api.dicebear.com/7.x/initials/svg?seed=${encodeURIComponent(dr.nome)}" alt="${dr.nome}" loading="lazy"/>
                  <span>${dr.nome}</span>
                  <span class="tag" title="Abilit√† (60‚Äì95)">Skill: ${formatNumber(dr.skill)}</span>
                </span>
              `).join('')}
            </div>
          </div>`;
        card.insertAdjacentHTML('afterbegin', `<span class="pos">P${idx+1}</span>`);
        teamsGrid.appendChild(card);
      });

      // Regole
      rulesBox.innerHTML = '';
      const r = RULES[current];
      rulesBox.appendChild(html(`<ul style="list-style:none; padding:0; margin:0; display:grid; gap:10px">
        <li><strong>Distribuzione punti:</strong> ${r.punti.join('‚Äì')} ${r.puntoGiroVeloce ? '(+1 giro veloce)' : ''}</li>
        <li><strong>Numero gare:</strong> ${r.numeroGare}</li>
        <li><strong>Ultima gara a punteggio doppio:</strong> ${r.ultimaGaraDoppioPunteggio? 'S√¨' : 'No'}</li>
        <li><strong>Note:</strong> ${r.note ?? '‚Äî'}</li>
      </ul>`));

      // Calendario
      chips.innerHTML = '';
      (CALENDAR[current]||[]).forEach((g, i) => {
        const c = document.createElement('span');
        c.className = 'chip';
        c.textContent = (i+1).toString().padStart(2,'0') + ' ¬∑ ' + g;
        chips.appendChild(c);
      });

      // Classifica piloti (per PUNTI)
      const driversRows = [];
      [...data.entries()].forEach(([teamName, team]) => (team.piloti||[]).forEach(dr => driversRows.push({
        driver: dr.nome, team: teamName, pts: dr.punti || 0
      })));
      driversRows.sort((a,b)=> b.pts - a.pts || a.driver.localeCompare(b.driver));
      tblDrivers.innerHTML = driversRows.map((r,i)=>`<tr><td>${i+1}</td><td>${r.driver}</td><td>${r.team}</td><td><strong>${formatNumber(r.pts)}</strong></td></tr>`).join('');

      // Classifica scuderie (per punti totali scuderia)
      const teamRows = [...data.keys()].map(teamName => {
        const team = data.get(teamName) || { piloti: [] };
        const drivers = team.piloti || [];
        const pts = drivers.reduce((s,d)=> s + (d.punti||0), 0);
        return { team: teamName, pts };
      });
      teamRows.sort((a,b)=> b.pts - a.pts || a.team.localeCompare(b.team));
      tblTeams.innerHTML = teamRows.map((r,i)=>`<tr><td>${i+1}</td><td>${r.team}</td><td><strong>${formatNumber(r.pts)}</strong></td></tr>`).join('');
    }

    function html(str){ const t = document.createElement('template'); t.innerHTML = str.trim(); return t.content.firstChild; }

    // Carica piloti.json e prepara state, poi render
    fetch('piloti.json', { cache: 'no-store' })
      .then(r => r.json())
      .then(list => {
        // list: array di { categoria, scuderia, piloti: [{nome, skill} ...] }
        list.forEach(entry => {
          const series = (entry.categoria||'').toUpperCase();
          if(!state.dataBySeries[series]) return; // ignora categorie sconosciute
          const map = state.dataBySeries[series];
          const teamName = entry.scuderia;
          const piloti = (entry.piloti || []).map(p => ({
          nome: p.nome,
          skill: toNum(p.skill),
          punti: toNum(p.punti)
        }));
        map.set(teamName, { colore: entry.colore || null, proprietario: entry.proprietario || null, piloti });
        });
        render();
      })
      .catch(err => {
        console.error('Errore nel caricamento di piloti.json', err);
        // Fallback minimo per non rompere la pagina
        state.dataBySeries.F1.set('Apex Racing', { colore:'#ff1a1a', piloti:[ {nome:'Luca Bianchi', skill:85, punti:132}, {nome:'Max Duarte', skill:78, punti:98} ] });
        state.dataBySeries.F1.set('Crimson Motorsport', { colore:'#ff6b6b', piloti:[ {nome:'Kenji Mori', skill:88, punti:104}, {nome:'Diego Santos', skill:81, punti:88} ] });
        state.dataBySeries.F2.set('Silverline', { colore:'#1dd1a1', piloti:[ {nome:'Matteo Ricci', skill:80, punti:79}, {nome:'Arman Yilmaz', skill:74, punti:64} ] });
        state.dataBySeries.F3.set('Green Arrow', { colore:'#ffd166', piloti:[ {nome:'Paolo Serra', skill:73, punti:40}, {nome:'Anna Kovacs', skill:70, punti:36} ] });
        render();
      });
  </script>
</body>
</html>
